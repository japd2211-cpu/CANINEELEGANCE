<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Canine Elegance — Reservar Cita</title>
  <meta name="description" content="Reserva tu cita de grooming en Canine Elegance. Rápido, elegante y sin complicaciones." />
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#faf8fb;
      --card:#ffffff;
      --ink:#2b2b2f;
      --muted:#6b6b74;
      --brand:#787a86;
      --brand-acc:#b9bcc6;
      --ok:#1b8a5a;
      --warn:#b45309;
      --err:#b91c1c;
      --radius:18px;
      --shadow:0 10px 30px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1200px 800px at 85% -10%, #f3f2f6 0%, transparent 60%),
                radial-gradient(1100px 700px at -10% 110%, #f1eef6 0%, transparent 60%), var(--bg);
      color:var(--ink); font:16px/1.6 Montserrat, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    header{
      max-width:1100px; margin:32px auto 16px; padding:0 20px; display:flex; gap:16px; align-items:center; justify-content:space-between;
    }
    .brand{display:flex; align-items:center; gap:14px}
    .logo{display:none} /* reemplazado por .logo-img */
    h1{margin:0; font:700 24px/1.2 Playfair Display, serif; letter-spacing:.3px}
    .sub{color:var(--muted); font-size:14px}

    .wrap{max-width:1100px; margin:0 auto; padding:12px 20px 40px;}
    .grid{display:grid; grid-template-columns:1.1fr .9fr; gap:22px}

    .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px}
    .card h2{margin:0 0 14px; font:700 18px/1.2 Montserrat; letter-spacing:.2px}
    label{display:block; font-weight:600; margin:14px 0 6px}
    input[type="text"], input[type="tel"], input[type="email"], input[type="date"], input[type="time"], select, textarea{
      width:100%; padding:12px 14px; border:1px solid #e6e7eb; border-radius:12px; background:#fbfbfd; outline:none; transition:.2s border-color, .2s box-shadow;
    }
    textarea{min-height:90px; resize:vertical}
    input:focus, select:focus, textarea:focus{border-color:var(--brand); box-shadow:0 0 0 4px rgba(120,122,134,.12)}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}

    .services{display:grid; gap:10px}
    .chip{display:flex; align-items:center; justify-content:space-between; gap:8px; border:1px solid #e9eaf0; background:#fcfcff; padding:10px 12px; border-radius:12px}
    .chip strong{font-weight:600}
    .muted{color:var(--muted); font-size:12px}

    .actions{display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:18px}
    .btn{appearance:none; border:0; cursor:pointer; border-radius:14px; padding:12px 16px; font-weight:700; letter-spacing:.2px}
    .btn-primary{background:linear-gradient(180deg, var(--brand), #838796); color:#fff; box-shadow:0 10px 18px rgba(120,122,134,.22)}
    .btn-ghost{background:#f3f4f7; color:#2f3137}
    .btn:disabled{opacity:.5; cursor:not-allowed}

    .aside{position:sticky; top:20px}
    .summary{display:grid; gap:10px}
    .summary .line{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-radius:12px; background:#f7f8fb; border:1px dashed #e4e6ee}
    .summary .price{font-weight:800}

    .note{background:#f7f7fb; border-left:4px solid var(--brand-acc); padding:12px 14px; border-radius:10px; font-size:14px; color:#3f4150}
    .foot{margin-top:18px; font-size:13px; color:var(--muted)}

    .success{display:none; margin-top:14px; border-radius:12px; background:#e9f9ef; color:#065f46; padding:12px 14px; border:1px solid #bbefd1}
    .error{display:none; margin-top:14px; border-radius:12px; background:#fee2e2; color:#7f1d1d; padding:12px 14px; border:1px solid #fecaca}

    .logo-img{width:52px; height:52px; border-radius:14px; box-shadow:inset 0 1px 0 rgba(255,255,255,.5), 0 6px 16px rgba(0,0,0,.08); background:linear-gradient(135deg, #cfd2da, #9fa4b0); object-fit:cover}
    .logo-img[hidden]{display:none}

    @media (max-width: 900px){
      .grid{grid-template-columns:1fr}
      .aside{position:static}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img src="assets/logo.svg" alt="Canine Elegance" class="logo-img" onerror="this.hidden=true"/>
      <div>
        <h1>Canine Elegance</h1>
        <div class="sub">Reserva tu cita de grooming</div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <section class="card" aria-labelledby="formTitle">
        <h2 id="formTitle">Tu cita</h2>
        <div class="note" role="note">Horarios de atención: <strong>lunes a sábado, 9:00–18:00 (America/Puerto_Rico)</strong>. Domingo cerrado.</div>

        <form id="bookingForm" novalidate>
          <label for="clientName">Nombre y apellido</label>
          <input id="clientName" name="clientName" type="text" placeholder="Ej. Ana Rivera" autocomplete="name" required>

          <div class="row">
            <div>
              <label for="phone">WhatsApp / Teléfono</label>
              <input id="phone" name="phone" type="tel" placeholder="787 000 0000" autocomplete="tel" required>
            </div>
            <div>
              <label for="email">Correo (opcional)</label>
              <input id="email" name="email" type="email" placeholder="tu@correo.com" autocomplete="email">
            </div>
          </div>

          <label for="petName">Nombre de tu mascota</label>
          <input id="petName" name="petName" type="text" placeholder="Ej. Coco" required>

          <div class="row">
            <div>
              <label for="date">Fecha</label>
              <input id="date" name="date" type="date" required>
            </div>
            <div>
              <label for="time">Hora</label>
              <input id="time" name="time" type="time" step="1800" required>
            </div>
          </div>

          <label for="service">Servicio</label>
          <select id="service" name="service" required>
            <option value="" disabled selected>Selecciona un servicio</option>
            <option value="banio">Baño básico (45 min)</option>
            <option value="corte">Corte completo (90 min)</option>
            <option value="uñas">Corte de uñas (20 min)</option>
            <option value="spa">Spa premium (120 min)</option>
          </select>

          <div class="services">
            <div class="chip"><span><strong>Pick‑up / Drop‑off</strong> <span class="muted">(+$8)</span></span><label><input type="checkbox" id="pickup"/> Agregar</label></div>
            <div class="chip"><span><strong>Tratamiento antipulgas</strong> <span class="muted">(+$12)</span></span><label><input type="checkbox" id="fleas"/> Agregar</label></div>
          </div>

          <label for="notes">Notas (opcional)</label>
          <textarea id="notes" name="notes" placeholder="Alergias, estilo deseado, comportamiento, etc."></textarea>

          <div class="actions">
            <button type="submit" class="btn btn-primary">Reservar por WhatsApp</button>
            <button type="button" id="addCal" class="btn btn-ghost" disabled>Agregar al calendario (.ics)</button>
          </div>
          <div class="success" id="okMsg">¡Listo! Abriendo WhatsApp con tu reserva…</div>
          <div class="error" id="errMsg">Revisa los campos requeridos y el horario disponible.</div>
        </form>

        <div class="foot">Al enviar, se abrirá WhatsApp con el resumen de tu cita para confirmar. También puedes descargar un archivo .ics para tu calendario.</div>
      </section>

      <aside class="aside">
        <div class="card">
          <h2>Resumen</h2>
          <div class="summary" id="summary">
            <div class="line"><span>Cliente</span><span id="sumName" class="price">—</span></div>
            <div class="line"><span>Mascota</span><span id="sumPet">—</span></div>
            <div class="line"><span>Servicio</span><span id="sumService">—</span></div>
            <div class="line"><span>Fecha</span><span id="sumDate">—</span></div>
            <div class="line"><span>Hora</span><span id="sumTime">—</span></div>
            <div class="line"><span>Extras</span><span id="sumExtras">—</span></div>
            <div class="line"><span>Total estimado</span><span id="sumTotal" class="price">$0</span></div>
          </div>
        </div>
        <div class="card" style="margin-top:14px">
          <h2>Contacto</h2>
          <div class="note">¿Dudas rápidas? Escríbenos por WhatsApp: <strong>+1 787 394 7404</strong></div>
        </div>
      </aside>
    </div>
  </main>

  <script>
    const SERVICES = {
      banio: { name: 'Baño básico', price: 30, minutes: 45 },
      corte: { name: 'Corte completo', price: 55, minutes: 90 },
      uñas:  { name: 'Corte de uñas', price: 15, minutes: 20 },
      spa:   { name: 'Spa premium', price: 80, minutes: 120 }
    };
    const EXTRAS = {
      pickup: { name: 'Pick‑up / Drop‑off', price: 8 },
      fleas:  { name: 'Tratamiento antipulgas', price: 12 }
    };
    const TZ = 'America/Puerto_Rico';
    const $ = (sel) => document.querySelector(sel);
    function formatMoney(n){ return `$${n.toFixed(2)}`; }
    function pad(n){ return String(n).padStart(2,'0'); }
    function setMinDate(){
      const d = new Date();
      const y = d.getFullYear();
      const m = pad(d.getMonth()+1);
      const day = pad(d.getDate());
      document.querySelector('#date').min = `${y}-${m}-${day}`;
    }
    function isBusinessOpen(dateStr, timeStr){
      const dt = new Date(`${dateStr}T${timeStr}:00`);
      const day = dt.getDay();
      const hour = dt.getHours();
      const minutes = dt.getMinutes();
      const total = hour * 60 + minutes;
      return day >= 1 && day <= 6 && total >= 9*60 && total <= 18*60 - 30;
    }
    function calcEnd(dateStr, timeStr, minutes){
      const dt = new Date(`${dateStr}T${timeStr}:00`);
      dt.setMinutes(dt.getMinutes()+minutes);
      return `${pad(dt.getHours())}:${pad(dt.getMinutes())}`;
    }
    function buildSummary(){
      const name = document.querySelector('#clientName').value.trim();
      const pet = document.querySelector('#petName').value.trim();
      const date = document.querySelector('#date').value;
      const time = document.querySelector('#time').value;
      const svcKey = document.querySelector('#service').value;
      const svc = SERVICES[svcKey];
      const extras = [];
      let total = 0;
      if(svc){ total += svc.price; }
      if(document.querySelector('#pickup').checked){ extras.push(EXTRAS.pickup.name); total += EXTRAS.pickup.price; }
      if(document.querySelector('#fleas').checked){ extras.push(EXTRAS.fleas.name); total += EXTRAS.fleas.price; }
      document.querySelector('#sumName').textContent = name || '—';
      document.querySelector('#sumPet').textContent = pet || '—';
      document.querySelector('#sumService').textContent = svc ? `${svc.name}` : '—';
      document.querySelector('#sumDate').textContent = date || '—';
      document.querySelector('#sumTime').textContent = time ? `${time}${svc ? ` – ${calcEnd(date, time, svc.minutes)}`:''}` : '—';
      document.querySelector('#sumExtras').textContent = extras.length ? extras.join(', ') : 'Ninguno';
      document.querySelector('#sumTotal').textContent = formatMoney(total);
      document.querySelector('#addCal').disabled = !(name && pet && date && time && svc);
    }
    function encodeICS({title, description, startDate, startTime, endDate, endTime}){
      const dtStart = `${startDate.replace(/-/g,'') }T${startTime.replace(':','')}00`;
      const dtEnd   = `${endDate.replace(/-/g,'')   }T${endTime.replace(':','')}00`;
      const ics = `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Canine Elegance//Booking//ES\nBEGIN:VEVENT\nUID:${crypto.randomUUID()}\nDTSTAMP:${new Date().toISOString().replace(/[-:]/g,'').split('.')[0]}Z\nDTSTART:${dtStart}\nDTEND:${dtEnd}\nSUMMARY:${title}\nDESCRIPTION:${description}\nEND:VEVENT\nEND:VCALENDAR`;
      return 'data:text/calendar;charset=utf-8,' + encodeURIComponent(ics);
    }
    function openWhatsApp(message){
      const phone = '17873947404';
      const url = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
      window.open(url, '_blank');
    }
    ['#clientName','#petName','#date','#time','#service','#pickup','#fleas','#notes','#phone','#email'].forEach(sel=>{
      document.addEventListener('input', (e)=>{ if(e.target.matches(sel)) buildSummary(); });
      document.addEventListener('change', (e)=>{ if(e.target.matches(sel)) buildSummary(); });
    })
    document.querySelector('#bookingForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const name = document.querySelector('#clientName').value.trim();
      const phone = document.querySelector('#phone').value.trim();
      const email = document.querySelector('#email').value.trim();
      const pet = document.querySelector('#petName').value.trim();
      const date = document.querySelector('#date').value;
      const time = document.querySelector('#time').value;
      const svcKey = document.querySelector('#service').value;
      const notes = document.querySelector('#notes').value.trim();
      if(!name || !phone || !pet || !date || !time || !svcKey){
        document.querySelector('#errMsg').style.display='block';
        document.querySelector('#okMsg').style.display='none';
        return;
      }
      if(!isBusinessOpen(date, time)){
        document.querySelector('#errMsg').style.display='block';
        document.querySelector('#errMsg').textContent = 'Fuera del horario (lun‑sáb 9:00–18:00) o domingo. Elige otra hora.';
        document.querySelector('#okMsg').style.display='none';
        return;
      }
      const svc = SERVICES[svcKey];
      const endTime = calcEnd(date, time, svc.minutes);
      const extrasArr = [];
      if(document.querySelector('#pickup').checked) extrasArr.push(EXTRAS.pickup.name);
      if(document.querySelector('#fleas').checked) extrasArr.push(EXTRAS.fleas.name);
      const extras = extrasArr.length ? extrasArr.join(', ') : 'Ninguno';
      const total = (svc.price + (document.querySelector('#pickup').checked?EXTRAS.pickup.price:0) + (document.querySelector('#fleas').checked?EXTRAS.fleas.price:0)).toFixed(2);
      const prettyDate = new Date(`${date}T${time}:00`).toLocaleString('es-PR', { dateStyle:'full', timeStyle:'short', timeZone: TZ });
      const msg = `Hola, soy ${name}. Quisiera reservar para ${pet}.\n\nServicio: ${svc.name}\nExtras: ${extras}\nFecha y hora: ${prettyDate}\nDuración estimada: ${svc.minutes} min (fin aprox. ${endTime})\nTotal estimado: $${total}\n${notes?`Notas: ${notes}\n`:''}${email?`Correo: ${email}`:''}`.trim();
      document.querySelector('#okMsg').style.display='block';
      document.querySelector('#errMsg').style.display='none';
      openWhatsApp(msg);
      localStorage.setItem('ce_last_booking', JSON.stringify({name, phone, email, pet, date, time, svcKey, extras: {pickup: document.querySelector('#pickup').checked, fleas: document.querySelector('#fleas').checked}, notes}));
    });
    document.querySelector('#addCal').addEventListener('click', ()=>{
      const name = document.querySelector('#clientName').value.trim();
      const pet = document.querySelector('#petName').value.trim();
      const date = document.querySelector('#date').value;
      const time = document.querySelector('#time').value;
      const svcKey = document.querySelector('#service').value;
      if(!(name && pet && date && time && svcKey)) return;
      const svc = SERVICES[svcKey];
      const endTime = calcEnd(date, time, svc.minutes);
      const href = encodeICS({
        title: `Cita grooming — ${pet}`,
        description: `${svc.name} en Canine Elegance. Cliente: ${name}.`,
        startDate: date, startTime: time, endDate: date, endTime
      });
      const a = document.createElement('a');
      a.href = href; a.download = `cita-${pet}-${date}.ics`; a.click();
    });
    function restore(){
      setMinDate();
      const last = localStorage.getItem('ce_last_booking');
      if(!last) return;
      try{
        const data = JSON.parse(last);
        document.querySelector('#clientName').value = data.name || '';
        document.querySelector('#phone').value = data.phone || '';
        document.querySelector('#email').value = data.email || '';
        document.querySelector('#petName').value = data.pet || '';
        document.querySelector('#date').value = data.date || '';
        document.querySelector('#time').value = data.time || '';
        document.querySelector('#service').value = data.svcKey || '';
        document.querySelector('#pickup').checked = data.extras?.pickup || false;
        document.querySelector('#fleas').checked = data.extras?.fleas || false;
        document.querySelector('#notes').value = data.notes || '';
      }catch(e){}
      buildSummary();
    }
    restore();
  </script>
</body>
</html>